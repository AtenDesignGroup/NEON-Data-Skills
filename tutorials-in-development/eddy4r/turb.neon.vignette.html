<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="David Durden, Stefan Metzger, Natchaya Pingintha-Durden, Claire Lunch, Megan Jones" />

<meta name="date" content="2018-10-30" />

<title>Example workflow for processing NEON eddy-covariance turbulence data with eddy4R-Docker 0.2.0</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Example workflow for processing NEON eddy-covariance turbulence data with eddy4R-Docker 0.2.0</h1>
<h4 class="author"><em>David Durden, Stefan Metzger, Natchaya Pingintha-Durden, Claire Lunch, Megan Jones</em></h4>
<h4 class="date"><em>2018-10-30</em></h4>



<div id="install-and-set-up" class="section level2">
<h2>0. Install and set up</h2>
<p>This vignette assumes you are working with eddy4R within the Docker environment established by NEON. To get set up in that environment, follow the instructions <a href="neonscience.org/set-up-docker" target="_blank">here</a>.</p>
<p>At the end of those instructions, you should have an RStudio environment running within Docker. Use that workspace for this vignette.</p>
</div>
<div id="install-packages-and-set-up-environment" class="section level2">
<h2>1. Install packages and set up environment</h2>
<p>First, check for required packages and install any that arenâ€™t already installed. Once all required packages are installed, load them into the environment.</p>
<p>Throughout this vignette, we use the <code>package::function()</code> syntax to explicitly refer to functions. This is done to avoid any possibility of ambiguity, in case there are functions in different packages with the same name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
packReq &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;DataCombine&quot;</span>, <span class="st">&quot;eddy4R.base&quot;</span>, <span class="st">&quot;eddy4R.qaqc&quot;</span>,  
             <span class="st">&quot;ff&quot;</span>, <span class="st">&quot;ffbase&quot;</span>, <span class="st">&quot;methods&quot;</span>, <span class="st">&quot;rhdf5&quot;</span>,<span class="st">&quot;splus2R&quot;</span>)
base<span class="op">::</span><span class="kw">lapply</span>(packReq, <span class="cf">function</span>(x) {
  <span class="kw">print</span>(x)
  <span class="cf">if</span>(base<span class="op">::</span><span class="kw">require</span>(x, <span class="dt">character.only =</span> <span class="ot">TRUE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) {
    utils<span class="op">::</span><span class="kw">install.packages</span>(x)
    base<span class="op">::</span><span class="kw">library</span>(x, <span class="dt">character.only =</span> <span class="ot">TRUE</span>)
  }})
<span class="co">#&gt; [1] &quot;DataCombine&quot;</span>
<span class="co">#&gt; Loading required package: DataCombine</span>
<span class="co">#&gt; [1] &quot;eddy4R.base&quot;</span>
<span class="co">#&gt; Loading required package: eddy4R.base</span>
<span class="co">#&gt; [1] &quot;eddy4R.qaqc&quot;</span>
<span class="co">#&gt; Loading required package: eddy4R.qaqc</span>
<span class="co">#&gt; [1] &quot;ff&quot;</span>
<span class="co">#&gt; Loading required package: ff</span>
<span class="co">#&gt; Loading required package: bit</span>
<span class="co">#&gt; Attaching package bit</span>
<span class="co">#&gt; package:bit (c) 2008-2012 Jens Oehlschlaegel (GPL-2)</span>
<span class="co">#&gt; creators: bit bitwhich</span>
<span class="co">#&gt; coercion: as.logical as.integer as.bit as.bitwhich which</span>
<span class="co">#&gt; operator: ! &amp; | xor != ==</span>
<span class="co">#&gt; querying: print length any all min max range sum summary</span>
<span class="co">#&gt; bit access: length&lt;- [ [&lt;- [[ [[&lt;-</span>
<span class="co">#&gt; for more help type ?bit</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'bit'</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     xor</span>
<span class="co">#&gt; Attaching package ff</span>
<span class="co">#&gt; - getOption(&quot;fftempdir&quot;)==&quot;/tmp/RtmpcSnpno&quot;</span>
<span class="co">#&gt; - getOption(&quot;ffextension&quot;)==&quot;ff&quot;</span>
<span class="co">#&gt; - getOption(&quot;ffdrop&quot;)==TRUE</span>
<span class="co">#&gt; - getOption(&quot;fffinonexit&quot;)==TRUE</span>
<span class="co">#&gt; - getOption(&quot;ffpagesize&quot;)==65536</span>
<span class="co">#&gt; - getOption(&quot;ffcaching&quot;)==&quot;mmnoflush&quot;  -- consider &quot;ffeachflush&quot; if your system stalls on large writes</span>
<span class="co">#&gt; - getOption(&quot;ffbatchbytes&quot;)==16777216 -- consider a different value for tuning your system</span>
<span class="co">#&gt; - getOption(&quot;ffmaxbytes&quot;)==536870912 -- consider a different value for tuning your system</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ff'</span>
<span class="co">#&gt; The following objects are masked from 'package:bit':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     clone, clone.default, clone.list</span>
<span class="co">#&gt; The following objects are masked from 'package:utils':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     write.csv, write.csv2</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     is.factor, is.ordered</span>
<span class="co">#&gt; [1] &quot;ffbase&quot;</span>
<span class="co">#&gt; Loading required package: ffbase</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ffbase'</span>
<span class="co">#&gt; The following objects are masked from 'package:ff':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     [.ff, [.ffdf, [&lt;-.ff, [&lt;-.ffdf</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     %in%, table</span>
<span class="co">#&gt; [1] &quot;methods&quot;</span>
<span class="co">#&gt; [1] &quot;rhdf5&quot;</span>
<span class="co">#&gt; Loading required package: rhdf5</span>
<span class="co">#&gt; [1] &quot;splus2R&quot;</span>
<span class="co">#&gt; Loading required package: splus2R</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[7]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[8]]</span>
<span class="co">#&gt; NULL</span>
base<span class="op">::</span><span class="kw">rm</span>(packReq)</code></pre></div>
</div>
<div id="set-environment-variables" class="section level2">
<h2>2. Set environment variables</h2>
<p>Here we set file paths and basic input parameters as environment variables for convenience.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># File path for the directory containing input L0' data</span>
base<span class="op">::</span><span class="kw">Sys.setenv</span>(<span class="st">&quot;DIRINP&quot;</span> =<span class="st"> &quot;/home/eddy/inpExmp&quot;</span>) 

<span class="co"># File path for outputs</span>
base<span class="op">::</span><span class="kw">Sys.setenv</span>(<span class="st">&quot;DIROUT&quot;</span> =<span class="st"> &quot;/home/eddy/out&quot;</span>)

<span class="co"># Date(s) of the input data, specified here for the output file name</span>
base<span class="op">::</span><span class="kw">Sys.setenv</span>(<span class="st">&quot;DATEOUT&quot;</span> =<span class="st"> &quot;2017-09-01&quot;</span>)

<span class="co"># NEON domain, site, and data product ID of the input data</span>
<span class="co"># for the output file name:</span>
<span class="co"># Domain 10 = D10</span>
<span class="co"># Central Plains Experimental Range = CPER</span>
<span class="co"># Bundled eddy covariance data = 00200.001</span>
base<span class="op">::</span><span class="kw">Sys.setenv</span>(<span class="st">&quot;FILEOUTBASE&quot;</span> =<span class="st"> &quot;NEON.D10.CPER.00200.001&quot;</span>)

<span class="co"># Flag to indicate to the eddy4R.base::def.para.flow() </span>
<span class="co"># function that the variables above can be found as </span>
<span class="co"># environment variables, instead of provided as function </span>
<span class="co"># inputs</span>
base<span class="op">::</span><span class="kw">Sys.setenv</span>(<span class="st">&quot;METHPARAFLOW&quot;</span> =<span class="st"> &quot;EnvVar&quot;</span>)</code></pre></div>
</div>
<div id="read-in-metadata" class="section level2">
<h2>3. Read in metadata</h2>
<p>Pass along the environment variables defined in section 2, then read in additional parameters from the HDF5 file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># In this section, define and/or read in a number of terms and </span>
<span class="co"># parameters.</span>

<span class="co"># Create an empty list for parameters.</span>
Para &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">list</span>()

<span class="co"># Use the def.para.flow() function to specify the metadata are stored </span>
<span class="co"># in environment variables, and give file paths to input and output.</span>
<span class="co"># You will see a number of warning messages in response to this line, </span>
<span class="co"># but if you can proceed with the next several commands, don't worry </span>
<span class="co"># about the warnings here.</span>
Para<span class="op">$</span>Flow &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.para.flow</span>(<span class="dt">MethParaFlow =</span> <span class="st">&quot;EnvVar&quot;</span>)
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$Deve is not specified as</span>
<span class="co">#&gt; ENV variable</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$DirFilePara is not</span>
<span class="co">#&gt; specified as ENV variable</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$DirMnt is not specified</span>
<span class="co">#&gt; as ENV variable</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$DirTmp is not specified</span>
<span class="co">#&gt; as ENV variable</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$DirWrk is not specified</span>
<span class="co">#&gt; as ENV variable</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$Read is not specified as</span>
<span class="co">#&gt; ENV variable</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$VersDp is not specified</span>
<span class="co">#&gt; as ENV variable</span>
<span class="co">#&gt; Warning in FUN(X[[i]], ...): The variable ParaFlow$VersEddy is not</span>
<span class="co">#&gt; specified as ENV variable</span>
<span class="co">#&gt; Warning in eddy4R.base::def.para.flow(MethParaFlow = &quot;EnvVar&quot;): The</span>
<span class="co">#&gt; variable Loc is NULL</span>

<span class="co"># The args() function can be used to see the full list of function </span>
<span class="co"># arguments available in def.para.flow().</span>
<span class="co"># Additional metadata can be passed to the function as well, by</span>
<span class="co"># assigning a variable name in the functional call.</span>
base<span class="op">::</span><span class="kw">args</span>(eddy4R.base<span class="op">::</span>def.para.flow)
<span class="co">#&gt; function (Deve = TRUE, DirFilePara = NULL, DirInp = NA, DirMnt = NA, </span>
<span class="co">#&gt;     DirOut = NA, DirTmp = NA, DirWrk = NA, DateOut = NULL, FileOutBase = NULL, </span>
<span class="co">#&gt;     Read = &quot;hdf5&quot;, VersDp = c(&quot;001&quot;, &quot;004&quot;)[1], VersEddy = &quot;latest&quot;, </span>
<span class="co">#&gt;     MethParaFlow = c(&quot;DfltInp&quot;, &quot;EnvVar&quot;)[1], UrlInpRefe, UrlOutRefe, </span>
<span class="co">#&gt;     ...) </span>
<span class="co">#&gt; NULL</span>

<span class="co"># Get the NEON-specific 4-letter code for the site location (Loc) </span>
<span class="co"># from the dp0p input file   </span>
Para<span class="op">$</span>Flow<span class="op">$</span>Loc &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.para.site</span>(<span class="dt">FileInp =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara)<span class="op">$</span>Loc 

<span class="co"># Get the level of the tower top (LvlTowr) from the dp0p input file </span>
Para<span class="op">$</span>Flow<span class="op">$</span>LvlTowr &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.para.site</span>(<span class="dt">FileInp =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara)<span class="op">$</span>LvlTowr

<span class="co"># Use the def.hdf5.read.para() function to extract parameters </span>
<span class="co"># from the metadata in the input file and assign them to the </span>
<span class="co"># parameter list.</span>

<span class="co"># For each variable to be written out, set the aggregation </span>
<span class="co"># parameters.</span>
<span class="co"># Variables:</span>
<span class="co">#   amrs: Attitude Motion Reference System</span>
<span class="co">#   co2turb: Turbulent CO2 flux</span>
<span class="co">#   h2oTurb: Turbulent H2O flux</span>
<span class="co">#   soni: Windspeed and direction from sonic anemometer</span>
<span class="co"># Parameters:</span>
<span class="co">#   PrdIncrAgrDflt: Period Increment Aggregation Default</span>
<span class="co">#   PrdWndwAgrDflt: Period Window Aggregation Default</span>
<span class="cf">for</span>(idx <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;amrs&quot;</span>, <span class="st">&quot;co2Turb&quot;</span>, <span class="st">&quot;h2oTurb&quot;</span>, <span class="st">&quot;soni&quot;</span>)) {
  
  Para<span class="op">$</span>Flow<span class="op">$</span>dp01[[idx]] &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.hdf5.read.para</span>(
    <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
    <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp01/data/&quot;</span>, idx),
    <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;PrdIncrAgrDflt&quot;</span>, <span class="st">&quot;PrdWndwAgrDflt&quot;</span>)
  )
  
}
<span class="co">#&gt; Warning in is.na(x): is.na() applied to non-(list or vector) of type 'NULL'</span>

<span class="co"># AngEnuXaxs: Planar fit coefficient of the x axis</span>
<span class="co"># AngEnuYaxs: Planar fit coefficient of the y axis</span>
<span class="co"># Ofst: Planar fit offset</span>
<span class="co"># ZoneTime: Time zone of data collection</span>
<span class="co"># Note that a future release of the eddy4R package will </span>
<span class="co"># include a planar fit function, which will allow you to </span>
<span class="co"># set the planar fit coefficients to NA here, and then </span>
<span class="co"># use the function to estimate them. This workflow will </span>
<span class="co"># require a longer window of input data, on the order of </span>
<span class="co"># days to weeks, be provided to determine a robust </span>
<span class="co"># planar regression for the data.</span>
Para<span class="op">$</span>Sci &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.hdf5.read.para</span>(
  <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
  <span class="dt">GrpName =</span> Para<span class="op">$</span>Flow<span class="op">$</span>Loc,
  <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;Pf$AngEnuXaxs&quot;</span>, <span class="st">&quot;Pf$AngEnuYaxs&quot;</span>, <span class="st">&quot;Pf$Ofst&quot;</span>, <span class="st">&quot;ZoneTime&quot;</span>)
)

<span class="co"># In the next 5 commands, get the sampling frequency (FreqSamp) </span>
<span class="co"># of each instrument from the parameters in the input file:</span>
<span class="co"># irgaTurb: Turbulent flux gas analyzer</span>
<span class="co"># mfcSampTurb: Mass flow controller</span>
<span class="co"># valvValiNemaTurb: Valve Validation Nema enclosure Turbulence</span>
<span class="co"># soni, amrs: See above</span>
Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>irgaTurb &lt;-<span class="st"> </span><span class="kw">def.hdf5.read.para</span>(
      <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
      <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp0p/data/irgaTurb&quot;</span>),
      <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;FreqSamp&quot;</span>)
)

Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>mfcSampTurb &lt;-<span class="st"> </span><span class="kw">def.hdf5.read.para</span>(
      <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
      <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp0p/data/mfcSampTurb&quot;</span>),
      <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;FreqSamp&quot;</span>)
)

Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>valvValiNemaTurb &lt;-<span class="st"> </span><span class="kw">def.hdf5.read.para</span>(
      <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
      <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp0p/data/valvValiNemaTurb&quot;</span>),
      <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;FreqSamp&quot;</span>)
)
<span class="co">#&gt; Warning in is.na(x): is.na() applied to non-(list or vector) of type 'NULL'</span>

<span class="co"># For the sonic anemometer, also get the angle of the z axis </span>
<span class="co"># relative to the North-East-Down coordinate system used </span>
<span class="co"># for sonic anemometer installation (AngNedZaxs)</span>
Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>soni &lt;-<span class="st"> </span><span class="kw">def.hdf5.read.para</span>(
      <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
      <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp0p/data/soni&quot;</span>),
      <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;AngNedZaxs&quot;</span>,<span class="st">&quot;FreqSamp&quot;</span>)
)

Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>amrs &lt;-<span class="st"> </span><span class="kw">def.hdf5.read.para</span>(
      <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
      <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp0p/data/amrs&quot;</span>),
      <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;FreqSamp&quot;</span>)
)

<span class="co"># Lag$TimeDiff: The time lag to align gas concentration data </span>
<span class="co"># with wind measurements, allowing for travel time from the inlet</span>
<span class="co"># to the gas analyzer.</span>
<span class="co"># The next two commands create the TimeDiff parameter for CO2</span>
<span class="co"># and H2O, but leave them set to NA. Lag time is calculated by </span>
<span class="co"># eddy4R.base::def.lag(). If you prefer to set it manually, </span>
<span class="co"># the def.lag() function can also set it.</span>
Para<span class="op">$</span>Sci<span class="op">$</span>dp01<span class="op">$</span>co2Turb<span class="op">$</span>RtioMoleDryCo2 &lt;-<span class="st"> </span><span class="kw">def.hdf5.read.para</span>(
        <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
        <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp01/data/co2Turb/&quot;</span>, 
                         Para<span class="op">$</span>Flow<span class="op">$</span>LvlTowr, <span class="st">&quot;_30m/rtioMoleDryCo2&quot;</span>),
        <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;Lag$TimeDiff&quot;</span>)
)

Para<span class="op">$</span>Sci<span class="op">$</span>dp01<span class="op">$</span>h2oTurb<span class="op">$</span>RtioMoleDryH2o &lt;-<span class="st"> </span><span class="kw">def.hdf5.read.para</span>(
        <span class="dt">DirFileParaLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirFilePara,
        <span class="dt">GrpName =</span> <span class="kw">paste0</span>(<span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/dp01/data/h2oTurb/&quot;</span>, 
                         Para<span class="op">$</span>Flow<span class="op">$</span>LvlTowr, <span class="st">&quot;_30m/rtioMoleDryH2o&quot;</span>),
        <span class="dt">SetPara =</span> <span class="kw">c</span>(<span class="st">&quot;Lag$TimeDiff&quot;</span>)
)

<span class="co"># Create a version label for your outputs, using the </span>
<span class="co"># current system time</span>
Para<span class="op">$</span>Flow<span class="op">$</span>VersDp &lt;-<span class="st"> </span><span class="kw">paste0</span>(Para<span class="op">$</span>Flow<span class="op">$</span>VersDp, <span class="st">&quot;_&quot;</span>, 
                           <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;%Y%m%d_%H%M%S_%Z&quot;</span>))

<span class="co"># Create a list of the sampling frequencies of the essential </span>
<span class="co"># instruments, extracted from the input data above.</span>
FreqSamp &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="st">&quot;irgaTurb&quot;</span> =<span class="st"> </span>Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>irgaTurb<span class="op">$</span>FreqSamp,
  <span class="st">&quot;mfcSampTurb&quot;</span> =<span class="st"> </span>Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>mfcSampTurb<span class="op">$</span>FreqSamp,
  <span class="st">&quot;valvValiNemaTurb&quot;</span> =<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">length</span>(<span class="kw">as.numeric</span>(Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>valvValiNemaTurb<span class="op">$</span>FreqSamp))<span class="op">==</span><span class="dv">0</span>,
                              <span class="fl">0.2</span>, <span class="kw">as.numeric</span>(Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>valvValiNemaTurb<span class="op">$</span>FreqSamp)),
  <span class="st">&quot;soni&quot;</span> =<span class="st"> </span>Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>soni<span class="op">$</span>FreqSamp,
  <span class="st">&quot;amrs&quot;</span> =<span class="st"> </span>Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>amrs<span class="op">$</span>FreqSamp
)</code></pre></div>
</div>
<div id="variable-ranges" class="section level2">
<h2>4. Variable ranges</h2>
<p>Set plausible ranges for the input variables, to be tested on ingest. Then set paths for the working directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Create an empty list for range values.</span>
Rng &lt;-<span class="st"> </span><span class="kw">list</span>()
  
<span class="co"># Set ranges for gas analyzer variables:</span>
<span class="co"># densMoleCo2: CO2 molar density, mol m-3</span>
<span class="co"># densMoleH2o: H2O molar density, mol m-3</span>
<span class="co"># presAtm: Atmospheric pressure, Pa</span>
<span class="co"># presDiff: Difference in pressure, Pa</span>
<span class="co"># rtioMoleDryCo2: Mole ratio of CO2 in air, mol mol-1</span>
<span class="co"># rtioMoleDryH2o: Mole ratio of H2O in air, mol mol-1</span>
<span class="co"># tempIn: Temperature of air at inlet, K</span>
<span class="co"># tempOut: Temperature of air at outlet, K</span>
Rng<span class="op">$</span>irgaTurb &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="st">&quot;densMoleCo2&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1e-3</span>,
  <span class="st">&quot;densMoleH2o&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1500</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1e-3</span>,
  <span class="st">&quot;presAtm&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">120</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1e3</span>,
  <span class="st">&quot;presDiff&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1e3</span>,
  <span class="st">&quot;rtioMoleDryCo2&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">300</span>,<span class="dv">450</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1e-6</span>,
  <span class="st">&quot;rtioMoleDryH2o&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1e-3</span>,
  <span class="st">&quot;tempIn&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">220</span>,<span class="dv">330</span>),
  <span class="st">&quot;tempOut&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">220</span>,<span class="dv">330</span>)
)

<span class="co"># Set ranges for sonic anemometer variables:</span>
<span class="co"># veloXaxs: Velocity on the x axis, m s-1</span>
<span class="co"># veloYaxs: Velocity on the y axis, m s-1</span>
<span class="co"># veloZaxs: Velocity on the z axis, m s-1</span>
<span class="co"># veloSoni: Speed of sound, m s-1</span>
Rng<span class="op">$</span>soni &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="st">&quot;veloXaxs&quot;</span>=<span class="kw">c</span>(<span class="op">-</span><span class="dv">50</span>,<span class="dv">50</span>),
  <span class="st">&quot;veloYaxs&quot;</span>=<span class="kw">c</span>(<span class="op">-</span><span class="dv">50</span>,<span class="dv">50</span>),
  <span class="st">&quot;veloZaxs&quot;</span>=<span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">10</span>),
  <span class="st">&quot;veloSoni&quot;</span>=<span class="kw">c</span>(<span class="dv">300</span>,<span class="dv">400</span>)
)

<span class="co"># Set ranges for attitude and motion reference variables:</span>
<span class="co"># angXaxs: Deviation from the x axis, degree</span>
<span class="co"># angYaxs: Deviation from the y axis, degree</span>
<span class="co"># angZaxs: Deviation from the z axis, degree</span>
Rng<span class="op">$</span>amrs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="st">&quot;angXaxs&quot;</span>=<span class="kw">c</span>(<span class="op">-</span><span class="dv">360</span>,<span class="dv">360</span>),
  <span class="st">&quot;angYaxs&quot;</span>=<span class="kw">c</span>(<span class="op">-</span><span class="dv">360</span>,<span class="dv">360</span>),
  <span class="st">&quot;angZaxs&quot;</span>=<span class="kw">c</span>(<span class="op">-</span><span class="dv">360</span>,<span class="dv">360</span>)
)

<span class="co"># Set directories and file paths</span>
<span class="co"># As written, this vignette uses the default paths. To use custom </span>
<span class="co"># paths, assign the file paths you want to use to the parameters</span>
<span class="co"># Para$Flow$DirWrk, Para$Flow$DirInp, and Para$Flow$DirOut before</span>
<span class="co"># proceeding to the code below.</span>

<span class="co"># Working directory</span>
<span class="co"># Default: use a temporary working directory on Docker filesystem</span>
<span class="cf">if</span>(<span class="kw">is.na</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirWrk)) {
  Para<span class="op">$</span>Flow<span class="op">$</span>DirWrk &lt;-<span class="st"> </span><span class="kw">tempdir</span>()

  <span class="co"># Optional: create a user-specified working directory, e.g. on host filesystem</span>
  } <span class="cf">else</span> {
    <span class="kw">dir.create</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirWrk, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)
  }

<span class="co"># Directory for input data</span>
<span class="co"># Default: use temporary working directory on Docker filesystem</span>
<span class="cf">if</span>(<span class="kw">is.na</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirInp)) {
  Para<span class="op">$</span>Flow<span class="op">$</span>DirInp &lt;-<span class="st"> </span><span class="kw">paste0</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirWrk, <span class="st">&quot;/inpRefe&quot;</span>)
  
  <span class="co"># Optional: create user-specified input directory</span>
  } <span class="cf">else</span> {
    <span class="kw">dir.create</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirInp, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)
  }

<span class="co"># Directory for output data</span>
<span class="co"># Default: use temporary working directory on Docker filesystem</span>
<span class="cf">if</span>(<span class="kw">is.na</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirOut)) {
  Para<span class="op">$</span>Flow<span class="op">$</span>DirOut &lt;-<span class="st"> </span><span class="kw">paste0</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirWrk, <span class="st">&quot;/out&quot;</span>)
  
  <span class="co"># Optional: create user-specified input directory</span>
  } <span class="cf">else</span> {
    <span class="kw">dir.create</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirOut, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)
  }</code></pre></div>
</div>
<div id="read-in-data" class="section level2">
<h2>5. Read in data!</h2>
<p>We have found in testing that this section may run into trouble if Docker is not assigned sufficient memory in your system. If you find that this section hangs or errors out, try opening Docker -&gt; Preferences -&gt; Advanced and increasing the memory allotment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Create empty lists for data and quality flags</span>
data &lt;-<span class="st"> </span><span class="kw">list</span>()
qfqmFlag &lt;-<span class="st"> </span><span class="kw">list</span>()

<span class="co"># Index for the number of days iterated over, and empty list for outputs</span>
numDate &lt;-<span class="st"> </span><span class="dv">0</span>
out &lt;-<span class="st"> </span><span class="kw">list</span>()

<span class="co"># Loop over days in input data (in the example data here, there is </span>
<span class="co"># only one day)</span>
<span class="cf">for</span>(date <span class="cf">in</span> Para<span class="op">$</span>Flow<span class="op">$</span>DateOut) {
  numDate &lt;-<span class="st"> </span>numDate <span class="op">+</span><span class="st"> </span><span class="dv">1</span>

  <span class="co"># Begin: read raw data from HDF5 file</span>
  <span class="cf">if</span>(Para<span class="op">$</span>Flow<span class="op">$</span>Read <span class="op">==</span><span class="st"> &quot;hdf5&quot;</span>) {

    <span class="co"># Create directory structure</span>
    <span class="kw">dir.create</span>(<span class="kw">paste</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirOut, <span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;/&quot;</span>, 
                     Para<span class="op">$</span>Flow<span class="op">$</span>VersDp, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>), 
               <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)

    <span class="co"># Create empty list for inputs</span>
    inp &lt;-<span class="st"> </span><span class="kw">list</span>()
    
    <span class="co"># Loop over instruments</span>
    <span class="cf">for</span>(Var <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;irgaTurb&quot;</span>, <span class="st">&quot;mfcSampTurb&quot;</span>, <span class="st">&quot;valvValiNemaTurb&quot;</span>, <span class="st">&quot;soni&quot;</span>, <span class="st">&quot;amrs&quot;</span>)){

      <span class="co"># Use data read function, assigning results to a temporary variable</span>
      tmp &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">wrap.hdf5.read</span>(
        <span class="dt">DirInpLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirInp,
        <span class="dt">SiteLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>Loc,
        <span class="dt">DateLoca =</span> date,
        <span class="dt">VarLoca =</span> Var,
        <span class="dt">FreqLoca =</span> FreqSamp[[Var]],
        <span class="dt">LvlTowr =</span> Para<span class="op">$</span>Flow<span class="op">$</span>LvlTowr,
        <span class="dt">RngLoca =</span> Rng,
        
        <span class="co"># Assign de-spiking parameters:</span>
        <span class="co">#   widt: WndwDspkBr86 de-spiking median filter window width [s]</span>
        <span class="co">#   nbin: NumDspkBr86Bin de-spiking histogram bins initial number/step size</span>
        <span class="co">#   rest: ThshDspkBr86Reso de-spiking resolution threshold</span>
        <span class="dt">DespLoca =</span> <span class="kw">list</span>(<span class="dt">widt =</span> <span class="dv">9</span>,
                        <span class="dt">nbin =</span> <span class="dv">2</span>,
                        <span class="dt">rest =</span> <span class="dv">10</span>
                        )
        )

      <span class="co"># Read in quality flags from HDF5 file</span>
      <span class="cf">if</span>(<span class="op">!</span>Var <span class="op">%in%</span><span class="st"> &quot;valvValiNemaTurb&quot;</span>){
      
        tmpQfqm &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.hdf5.read.qfqm</span>(
          <span class="dt">DirInpLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>DirInp,
          <span class="dt">SiteLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>Loc,
          <span class="dt">DateLoca =</span> date,
          <span class="dt">VarLoca =</span> Var,
          <span class="dt">FreqLoca =</span> FreqSamp[[Var]],
          <span class="dt">LvlTowr =</span> Para<span class="op">$</span>Flow<span class="op">$</span>LvlTowr
        )
      
      <span class="co"># Remove timestamp from flags, since timestamps will be </span>
      <span class="co"># saved elsewhere</span>
      tmpQfqm &lt;-<span class="st"> </span>tmpQfqm[,<span class="kw">grep</span>(<span class="st">&quot;time&quot;</span>,<span class="kw">names</span>(tmpQfqm),<span class="dt">invert =</span> T)]
      }
      
      <span class="co"># Copy results from temporary variables to inp</span>
      
      <span class="co"># Time domain, including unit assignment</span>
      <span class="cf">if</span>(Var <span class="op">==</span><span class="st"> &quot;irgaTurb&quot;</span>) {
        inp<span class="op">$</span>time &lt;-<span class="st"> </span>ff<span class="op">::</span><span class="kw">as.ffdf.data.frame</span>(<span class="kw">data.frame</span>(<span class="dt">UTC =</span> tmp<span class="op">$</span>time))
        base<span class="op">::</span><span class="kw">attr</span>(<span class="dt">x =</span> inp<span class="op">$</span>time<span class="op">$</span>UTC, <span class="dt">which =</span> <span class="st">&quot;unit&quot;</span>) &lt;-<span class="st"> &quot;YYYY-MM-DD hh:mm:ss.sss&quot;</span>
        }

      <span class="co"># Sensor data, including unit assignment</span>
      inp<span class="op">$</span>data[[Var]] &lt;-<span class="st"> </span>ff<span class="op">::</span><span class="kw">as.ffdf.data.frame</span>(tmp<span class="op">$</span>data)
      <span class="cf">for</span>(idx <span class="cf">in</span> base<span class="op">::</span><span class="kw">names</span>(tmp<span class="op">$</span>data)) 
        base<span class="op">::</span><span class="kw">attr</span>(<span class="dt">x =</span> inp<span class="op">$</span>data[[Var]][[idx]], <span class="dt">which =</span> <span class="st">&quot;unit&quot;</span>) &lt;-
<span class="st">        </span>base<span class="op">::</span><span class="kw">attr</span>(<span class="dt">x =</span> tmp<span class="op">$</span>data, <span class="dt">which =</span> <span class="st">&quot;unit&quot;</span>)[[idx]]
      
      <span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;tmpQfqm&quot;</span>)) inp<span class="op">$</span>qfqm[[Var]] &lt;-<span class="st"> </span>ff<span class="op">::</span><span class="kw">as.ffdf.data.frame</span>(tmpQfqm)

      <span class="co"># Remove temporary variables</span>
      <span class="kw">rm</span>(tmp)
      <span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;tmpQfqm&quot;</span>)) 
        <span class="kw">rm</span>(tmpQfqm)
      <span class="kw">invisible</span>(<span class="kw">gc</span>())
    
      <span class="co"># End loop over instruments</span>
      }; <span class="kw">rm</span>(Var)

    <span class="co"># Calculate derived quantities: daily extent, native resolution</span>
    inp &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">wrap.derv.prd.day</span>(
      <span class="dt">inpList =</span> inp,
      <span class="dt">ZoneTime =</span> Para<span class="op">$</span>Sci<span class="op">$</span>ZoneTime,
      <span class="dt">AngZaxsSoniInst =</span> Para<span class="op">$</span>Sci<span class="op">$</span>dp0p<span class="op">$</span>soni<span class="op">$</span>AngNedZaxs
      )

    <span class="co"># Print status message</span>
    <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;%F %T&quot;</span>), <span class="st">&quot;: dataset &quot;</span>, date, 
                 <span class="st">&quot;: derived quantities calculated (daily extent, native resolution)&quot;</span>))
      
  <span class="co"># End of raw data read</span>
  }

  <span class="co"># Assign daily data and attributes to file-backed objects </span>
  <span class="co">#   to keep RAM footprint small</span>
  <span class="co"># If loop is on the first day, create the attributes:</span>
  <span class="cf">if</span>(numDate <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
      
    <span class="co"># IRGA</span>
    data<span class="op">$</span>irgaTurb &lt;-<span class="st"> </span>inp<span class="op">$</span>data<span class="op">$</span>irgaTurb
    qfqmFlag<span class="op">$</span>irgaTurb &lt;-<span class="st"> </span>inp<span class="op">$</span>qfqm<span class="op">$</span>irgaTurb

    <span class="co"># MFC</span>
    data<span class="op">$</span>mfcSampTurb &lt;-<span class="st"> </span>inp<span class="op">$</span>data<span class="op">$</span>mfcSampTurb
    qfqmFlag<span class="op">$</span>mfcSampTurb &lt;-<span class="st"> </span>inp<span class="op">$</span>qfqm<span class="op">$</span>mfcSampTurb
      
    <span class="co"># Sonic anemometer</span>
    data<span class="op">$</span>soni &lt;-<span class="st"> </span>inp<span class="op">$</span>data<span class="op">$</span>soni
    qfqmFlag<span class="op">$</span>soni &lt;-<span class="st"> </span>inp<span class="op">$</span>qfqm<span class="op">$</span>soni

    <span class="co"># AMRS</span>
    data<span class="op">$</span>amrs &lt;-<span class="st"> </span>inp<span class="op">$</span>data<span class="op">$</span>amrs
    qfqmFlag<span class="op">$</span>amrs &lt;-<span class="st"> </span>inp<span class="op">$</span>qfqm<span class="op">$</span>amrs
    
    <span class="co"># Time objects</span>
    data<span class="op">$</span>time &lt;-<span class="st"> </span>inp<span class="op">$</span>time
    qfqmFlag<span class="op">$</span>time &lt;-<span class="st"> </span>inp<span class="op">$</span>time

    <span class="co"># If loop is on any day after the first, append the attributes:</span>
    } <span class="cf">else</span> {

      <span class="co"># IRGA</span>
      data<span class="op">$</span>irgaTurb &lt;-<span class="st"> </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> data<span class="op">$</span>irgaTurb, 
                                          <span class="dt">dat =</span> inp<span class="op">$</span>data<span class="op">$</span>irgaTurb)
      qfqmFlag<span class="op">$</span>irgaTurb &lt;-<span class="st">  </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span>qfqmFlag<span class="op">$</span>irgaTurb, 
                                               <span class="dt">dat =</span> inp<span class="op">$</span>qfqm<span class="op">$</span>irgaTurb)

      <span class="co"># MFC</span>
      data<span class="op">$</span>mfcSampTurb &lt;-<span class="st"> </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> data<span class="op">$</span>mfcSampTurb, 
                                             <span class="dt">dat =</span> inp<span class="op">$</span>data<span class="op">$</span>mfcSampTurb)
      qfqmFlag<span class="op">$</span>mfcSampTurb &lt;-<span class="st">  </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> qfqmFlag<span class="op">$</span>mfcSampTurb, 
                                                  <span class="dt">dat =</span> inp<span class="op">$</span>qfqm<span class="op">$</span>mfcSampTurb)
      
      <span class="co"># valvValiNemaTurb</span>
      data<span class="op">$</span>valvValiNemaTurb &lt;-<span class="st"> </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> data<span class="op">$</span>valvValiNemaTurb, 
                                                  <span class="dt">dat =</span> inp<span class="op">$</span>data<span class="op">$</span>valvValiNemaTurb)
      qfqmFlag<span class="op">$</span>valvValiNemaTurb &lt;-<span class="st"> </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> qfqmFlag<span class="op">$</span>valvValiNemaTurb, 
                                                      <span class="dt">dat =</span> inp<span class="op">$</span>qfqm<span class="op">$</span>valvValiNemaTurb)
      
      <span class="co"># Sonic anemometer</span>
      data<span class="op">$</span>soni &lt;-<span class="st"> </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> data<span class="op">$</span>soni, <span class="dt">dat =</span> inp<span class="op">$</span>data<span class="op">$</span>soni)
      qfqmFlag<span class="op">$</span>soni &lt;-<span class="st">  </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span>qfqmFlag<span class="op">$</span>soni, <span class="dt">dat =</span> inp<span class="op">$</span>qfqm<span class="op">$</span>soni)
      
      <span class="co"># AMRS</span>
      data<span class="op">$</span>amrs &lt;-<span class="st"> </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> data<span class="op">$</span>amrs, <span class="dt">dat =</span> inp<span class="op">$</span>data<span class="op">$</span>amrs)
      qfqmFlag<span class="op">$</span>amrs &lt;-<span class="st">  </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span>qfqmFlag<span class="op">$</span>amrs, <span class="dt">dat =</span> inp<span class="op">$</span>qfqm<span class="op">$</span>amrs)
      
      <span class="co"># Time objects</span>
      data<span class="op">$</span>time &lt;-<span class="st"> </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span> data<span class="op">$</span>time, <span class="dt">dat =</span> inp<span class="op">$</span>time)
      qfqmFlag<span class="op">$</span>time &lt;-<span class="st">  </span>ffbase<span class="op">::</span><span class="kw">ffdfappend</span>(<span class="dt">x =</span>qfqmFlag<span class="op">$</span>time, <span class="dt">dat =</span> inp<span class="op">$</span>time)
     
    <span class="co"># End attributes assignment</span>
    }

  <span class="co"># Remove temporary list of input variables</span>
  inp &lt;-<span class="st"> </span><span class="ot">NULL</span>
  inpQfqm &lt;-<span class="st"> </span><span class="ot">NULL</span>
  <span class="kw">invisible</span>(<span class="kw">gc</span>())

<span class="co"># End loop</span>
}
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:13: dataset 2017-09-01: irgaTurb hdf5 read-in complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:15: dataset 2017-09-01: irgaTurb hdf5 attributes complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:16: dataset 2017-09-01: irgaTurb unit conversion complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:16: dataset 2017-09-01: irgaTurb regularization not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:16: dataset 2017-09-01: irgaTurb sensor diagnostics not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:16: dataset 2017-09-01: irgaTurb range test not selected&quot;</span>
<span class="co">#&gt; 161 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 432161 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 162 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 162 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 162 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 162 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 162 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 162 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:34: dataset 2017-09-01: irgaTurb de-spiking complete&quot;</span>
<span class="co">#&gt; Warning in H5Dread(h5dataset = h5dataset, h5spaceFile = h5spaceFile,</span>
<span class="co">#&gt; h5spaceMem = h5spaceMem, : integer value -2^63 replaced NA. See the section</span>
<span class="co">#&gt; 'Large integer data types' in the 'rhdf5' vignette for more details.</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; [1] 4</span>
<span class="co">#&gt; [1] 5</span>
<span class="co">#&gt; [1] 6</span>
<span class="co">#&gt; [1] 7</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; [1] 9</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; [1] 11</span>
<span class="co">#&gt; [1] 12</span>
<span class="co">#&gt; [1] 13</span>
<span class="co">#&gt; [1] 14</span>
<span class="co">#&gt; [1] 15</span>
<span class="co">#&gt; [1] 16</span>
<span class="co">#&gt; [1] 17</span>
<span class="co">#&gt; [1] 18</span>
<span class="co">#&gt; [1] 19</span>
<span class="co">#&gt; [1] 20</span>
<span class="co">#&gt; [1] 21</span>
<span class="co">#&gt; [1] 22</span>
<span class="co">#&gt; [1] 23</span>
<span class="co">#&gt; [1] 24</span>
<span class="co">#&gt; [1] 25</span>
<span class="co">#&gt; [1] 26</span>
<span class="co">#&gt; [1] 27</span>
<span class="co">#&gt; [1] 28</span>
<span class="co">#&gt; [1] 29</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; [1] 31</span>
<span class="co">#&gt; [1] 32</span>
<span class="co">#&gt; [1] 33</span>
<span class="co">#&gt; [1] 34</span>
<span class="co">#&gt; [1] 35</span>
<span class="co">#&gt; [1] 36</span>
<span class="co">#&gt; [1] 37</span>
<span class="co">#&gt; [1] 38</span>
<span class="co">#&gt; [1] 39</span>
<span class="co">#&gt; [1] 40</span>
<span class="co">#&gt; [1] 41</span>
<span class="co">#&gt; [1] 42</span>
<span class="co">#&gt; [1] 43</span>
<span class="co">#&gt; [1] 44</span>
<span class="co">#&gt; [1] 45</span>
<span class="co">#&gt; [1] 46</span>
<span class="co">#&gt; [1] 47</span>
<span class="co">#&gt; [1] 48</span>
<span class="co">#&gt; [1] 49</span>
<span class="co">#&gt; [1] 50</span>
<span class="co">#&gt; [1] 51</span>
<span class="co">#&gt; [1] 52</span>
<span class="co">#&gt; [1] 53</span>
<span class="co">#&gt; [1] 54</span>
<span class="co">#&gt; [1] 55</span>
<span class="co">#&gt; [1] 56</span>
<span class="co">#&gt; [1] 57</span>
<span class="co">#&gt; [1] 58</span>
<span class="co">#&gt; [1] 59</span>
<span class="co">#&gt; [1] 60</span>
<span class="co">#&gt; [1] 61</span>
<span class="co">#&gt; [1] 62</span>
<span class="co">#&gt; [1] 63</span>
<span class="co">#&gt; [1] 64</span>
<span class="co">#&gt; [1] 65</span>
<span class="co">#&gt; [1] 66</span>
<span class="co">#&gt; [1] 67</span>
<span class="co">#&gt; [1] 68</span>
<span class="co">#&gt; [1] 69</span>
<span class="co">#&gt; [1] 70</span>
<span class="co">#&gt; [1] 71</span>
<span class="co">#&gt; [1] 72</span>
<span class="co">#&gt; [1] 73</span>
<span class="co">#&gt; [1] 74</span>
<span class="co">#&gt; [1] 75</span>
<span class="co">#&gt; [1] 76</span>
<span class="co">#&gt; [1] 77</span>
<span class="co">#&gt; [1] 78</span>
<span class="co">#&gt; [1] 79</span>
<span class="co">#&gt; [1] 80</span>
<span class="co">#&gt; [1] 81</span>
<span class="co">#&gt; [1] 82</span>
<span class="co">#&gt; [1] 83</span>
<span class="co">#&gt; [1] 84</span>
<span class="co">#&gt; [1] 85</span>
<span class="co">#&gt; [1] 86</span>
<span class="co">#&gt; [1] 87</span>
<span class="co">#&gt; [1] 88</span>
<span class="co">#&gt; [1] 89</span>
<span class="co">#&gt; [1] 90</span>
<span class="co">#&gt; [1] 91</span>
<span class="co">#&gt; [1] 92</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:44: dataset 2017-09-01: mfcSampTurb hdf5 read-in complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:46: dataset 2017-09-01: mfcSampTurb hdf5 attributes complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:47: dataset 2017-09-01: mfcSampTurb unit conversion complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:47: dataset 2017-09-01: mfcSampTurb regularization not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:47: dataset 2017-09-01: mfcSampTurb sensor diagnostics not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:47: dataset 2017-09-01: mfcSampTurb range test not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:47: dataset 2017-09-01: mfcSampTurb de-spiking not performed&quot;</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; [1] 4</span>
<span class="co">#&gt; [1] 5</span>
<span class="co">#&gt; [1] 6</span>
<span class="co">#&gt; [1] 7</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; [1] 9</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:48: dataset 2017-09-01: valvValiNemaTurb hdf5 read-in complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:48: dataset 2017-09-01: valvValiNemaTurb hdf5 attributes complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:49: dataset 2017-09-01: valvValiNemaTurb unit conversion complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:49: dataset 2017-09-01: valvValiNemaTurb regularization not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:49: dataset 2017-09-01: valvValiNemaTurb sensor diagnostics not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:49: dataset 2017-09-01: valvValiNemaTurb range test not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:49: dataset 2017-09-01: valvValiNemaTurb de-spiking not performed&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:50: dataset 2017-09-01: soni hdf5 read-in complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:51: dataset 2017-09-01: soni hdf5 attributes complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:52: dataset 2017-09-01: soni unit conversion complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:52: dataset 2017-09-01: soni regularization not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:52: dataset 2017-09-01: soni sensor diagnostics not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:56:52: dataset 2017-09-01: soni range test not selected&quot;</span>
<span class="co">#&gt; 9 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 9 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 8 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; 7 out of 1728000 time series values in y are missing. </span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:00: dataset 2017-09-01: soni de-spiking complete&quot;</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; [1] 4</span>
<span class="co">#&gt; [1] 5</span>
<span class="co">#&gt; [1] 6</span>
<span class="co">#&gt; [1] 7</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; [1] 9</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; [1] 11</span>
<span class="co">#&gt; [1] 12</span>
<span class="co">#&gt; [1] 13</span>
<span class="co">#&gt; [1] 14</span>
<span class="co">#&gt; [1] 15</span>
<span class="co">#&gt; [1] 16</span>
<span class="co">#&gt; [1] 17</span>
<span class="co">#&gt; [1] 18</span>
<span class="co">#&gt; [1] 19</span>
<span class="co">#&gt; [1] 20</span>
<span class="co">#&gt; [1] 21</span>
<span class="co">#&gt; [1] 22</span>
<span class="co">#&gt; [1] 23</span>
<span class="co">#&gt; [1] 24</span>
<span class="co">#&gt; [1] 25</span>
<span class="co">#&gt; [1] 26</span>
<span class="co">#&gt; [1] 27</span>
<span class="co">#&gt; [1] 28</span>
<span class="co">#&gt; [1] 29</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:13: dataset 2017-09-01: amrs hdf5 read-in complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:16: dataset 2017-09-01: amrs hdf5 attributes complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:17: dataset 2017-09-01: amrs unit conversion complete&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:17: dataset 2017-09-01: amrs regularization not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:17: dataset 2017-09-01: amrs sensor diagnostics not selected&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:17: dataset 2017-09-01: amrs range test not selected&quot;</span>
<span class="co">#&gt; 9630 out of 3456000 time series values in y are missing. </span>
<span class="co">#&gt; 9690 out of 3456000 time series values in y are missing. </span>
<span class="co">#&gt; 9956 out of 3456000 time series values in y are missing. </span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:57:34: dataset 2017-09-01: amrs de-spiking complete&quot;</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; [1] 4</span>
<span class="co">#&gt; [1] 5</span>
<span class="co">#&gt; [1] 6</span>
<span class="co">#&gt; [1] 7</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; [1] 9</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; [1] 11</span>
<span class="co">#&gt; [1] 12</span>
<span class="co">#&gt; [1] 13</span>
<span class="co">#&gt; [1] 14</span>
<span class="co">#&gt; [1] 15</span>
<span class="co">#&gt; [1] 16</span>
<span class="co">#&gt; [1] 17</span>
<span class="co">#&gt; [1] 18</span>
<span class="co">#&gt; [1] 19</span>
<span class="co">#&gt; [1] 20</span>
<span class="co">#&gt; [1] 21</span>
<span class="co">#&gt; [1] 22</span>
<span class="co">#&gt; [1] 23</span>
<span class="co">#&gt; [1] 24</span>
<span class="co">#&gt; [1] 25</span>
<span class="co">#&gt; [1] 26</span>
<span class="co">#&gt; [1] 27</span>
<span class="co">#&gt; [1] 28</span>
<span class="co">#&gt; [1] 29</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; [1] 31</span>
<span class="co">#&gt; [1] 32</span>
<span class="co">#&gt; [1] 33</span>
<span class="co">#&gt; [1] 34</span>
<span class="co">#&gt; [1] 35</span>
<span class="co">#&gt; [1] 36</span>
<span class="co">#&gt; [1] 37</span>
<span class="co">#&gt; [1] 38</span>
<span class="co">#&gt; [1] 39</span>
<span class="co">#&gt; [1] 40</span>
<span class="co">#&gt; [1] 41</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:58:39: dataset 2017-09-01: derived quantities calculated (daily extent, native resolution)&quot;</span></code></pre></div>
</div>
<div id="begin-data-analysis." class="section level2">
<h2>6. Begin data analysis.</h2>
<p>The first step is to get the half-hourly indices used to extract data from the file-backed objects into internal memory as a list of data.frames. Then, the lag time correction is applied to the gas analyzer (IRGA) data, based on the sonic anemometer vertical velocity, using the eddy4R.base::def.lag() function. After the lag correction has been applied, the half-hourly derived data sub-products for relative humidity and dewpoint temperature are calculated.</p>
<p>Then, the input data that are provided as NEON Level 0 prime data products (high frequency raw data that has been time regularized and units converted) are subsetted, and naming syntax is changed to match NEON Level 1 data product output conventions. eddy4R.base::wrap.dp01.agr.prd() is used to calculate the 1-minute averaged data and quality metrics. Finally, we calculate 30-minute data using eddy4R.base::wrap.dp01() and determine the quality metrics and final quality flag using eddy4R.base::wrap.dp01.qfqm.ecte().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Kick off with a time stamp when processing starts</span>
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;%F %T&quot;</span>), <span class="st">&quot;: dataset &quot;</span>, date, 
             <span class="st">&quot; derived quantities (vignette) begin&quot;</span>))
<span class="co">#&gt; [1] &quot;2018-10-30 12:58:40: dataset 2017-09-01 derived quantities (vignette) begin&quot;</span>

<span class="co"># Create empty list for working parameters and variables</span>
wrk &lt;-<span class="st"> </span><span class="kw">list</span>()

<span class="co"># Create empty list for quality flag/quality metric data</span>
qfqm &lt;-<span class="st"> </span><span class="kw">list</span>()

<span class="co"># Set begin and end time for each 30-minute averaging interval,</span>
<span class="co"># for each instrument system</span>
<span class="kw">invisible</span>(<span class="kw">lapply</span>(<span class="kw">names</span>(data), <span class="cf">function</span>(x) {
  <span class="cf">if</span>(x <span class="op">==</span><span class="st"> &quot;amrs&quot;</span>) {
    wrk<span class="op">$</span>idx[[x]] &lt;&lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.idx.agr</span>(<span class="dt">time =</span> data<span class="op">$</span>amrs<span class="op">$</span>time, 
                                              <span class="dt">PrdAgr =</span> <span class="dv">1800</span>, 
                                              <span class="dt">FreqLoca =</span> <span class="dv">40</span>)
  }  <span class="cf">else</span> {  
    wrk<span class="op">$</span>idx[[x]] &lt;&lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.idx.agr</span>(<span class="dt">time =</span> data<span class="op">$</span>time<span class="op">$</span>UTC, 
                                              <span class="dt">PrdAgr =</span> <span class="dv">1800</span>, 
                                              <span class="dt">FreqLoca =</span> <span class="dv">20</span>)
  }}))

<span class="co"># If Deve flag, meaning Development, is set to TRUE, only run a </span>
<span class="co"># small number of iterations for testing purposes. Otherwise </span>
<span class="co"># iterate over all variables and time periods. This vignette </span>
<span class="co"># sets Deve=TRUE.</span>
<span class="cf">if</span> (Para<span class="op">$</span>Flow<span class="op">$</span>Deve <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {
  iter &lt;-<span class="st"> </span><span class="dv">10</span>
  } <span class="cf">else</span> {
    iter &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">sapply</span>(<span class="kw">names</span>(wrk<span class="op">$</span>idx), 
                       <span class="cf">function</span>(x) <span class="kw">length</span>(wrk<span class="op">$</span>idx[[x]]<span class="op">$</span>idxBgn)))
  }

<span class="co"># Another time stamp: Loop start</span>
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;%F %T&quot;</span>), <span class="st">&quot;: dataset &quot;</span>, 
             date, <span class="st">&quot; DP01 calculation begin&quot;</span>))
<span class="co">#&gt; [1] &quot;2018-10-30 12:58:40: dataset 2017-09-01 DP01 calculation begin&quot;</span>
numAgr &lt;-<span class="st"> </span><span class="dv">0</span>

<span class="cf">for</span>(idxAgr <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>iter) {
  
  numAgr &lt;-<span class="st"> </span>numAgr <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
  
  <span class="co"># Create an identifier for the loop iterations</span>
  lvlAgr &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;numAgr&quot;</span>, <span class="kw">ifelse</span>(numAgr <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>, 
                                    <span class="kw">paste0</span>(<span class="st">&quot;0&quot;</span>, numAgr), 
                                    numAgr))

  <span class="co"># Create empty list for data</span>
  wrk<span class="op">$</span>data &lt;-<span class="st"> </span><span class="kw">list</span>()
  
  <span class="co"># Loop over sensor systems to grab the data indices for the current aggregation period (i.e. 30 minute period of data).</span>
  <span class="cf">for</span>(idxSens <span class="cf">in</span> <span class="kw">names</span>(data)) {
    wrk<span class="op">$</span>data[[idxSens]] &lt;-<span class="st"> </span>data[[idxSens]][wrk<span class="op">$</span>idx[[idxSens]]<span class="op">$</span>idxBgn[idxAgr]<span class="op">:</span>
<span class="st">                                             </span>wrk<span class="op">$</span>idx[[idxSens]]<span class="op">$</span>idxEnd[idxAgr],]
    wrk<span class="op">$</span>qfqm[[idxSens]] &lt;-<span class="st"> </span>qfqmFlag[[idxSens]][wrk<span class="op">$</span>idx[[idxSens]]<span class="op">$</span>idxBgn[idxAgr]<span class="op">:</span>
<span class="st">                                                 </span>wrk<span class="op">$</span>idx[[idxSens]]<span class="op">$</span>idxEnd[idxAgr],]

    <span class="co"># Assign units for each variable, from metadata</span>
    <span class="cf">for</span>(idxVar <span class="cf">in</span> base<span class="op">::</span><span class="kw">names</span>(wrk<span class="op">$</span>data[[idxSens]])) {

      base<span class="op">::</span><span class="kw">attr</span>(<span class="dt">x =</span> wrk<span class="op">$</span>data[[idxSens]][[idxVar]], <span class="dt">which =</span> <span class="st">&quot;unit&quot;</span>) &lt;-
<span class="st">        </span>base<span class="op">::</span><span class="kw">attr</span>(<span class="dt">x =</span> data[[idxSens]][[idxVar]], <span class="dt">which =</span> <span class="st">&quot;unit&quot;</span>)
      
      }; <span class="kw">rm</span>(idxVar)
    
    }; <span class="kw">rm</span>(idxSens)

  <span class="co"># Lag time correction</span>
  <span class="co"># Select variables to be lagged</span>
  var &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;rtioMoleDryCo2&quot;</span>, <span class="st">&quot;rtioMoleDryH2o&quot;</span>, <span class="st">&quot;rtioMassH2o&quot;</span>, <span class="st">&quot;presH2o&quot;</span>)

  <span class="co"># Loop over lag correction variables</span>
  tmpRun &lt;-<span class="st"> </span><span class="dv">0</span>
  <span class="cf">for</span>(idxVar <span class="cf">in</span> var) {
    
    tmpRun &lt;-<span class="st"> </span>tmpRun <span class="op">+</span><span class="st"> </span><span class="dv">1</span>

    <span class="co"># Is lag pre-determined or calculated?</span>
    <span class="co"># If lag is calculated:</span>
    <span class="cf">if</span>((base<span class="op">::</span><span class="kw">length</span>(base<span class="op">::</span><span class="kw">grep</span>(<span class="dt">pattern =</span> <span class="st">&quot;CO2&quot;</span>, 
                                <span class="dt">x =</span> idxVar, 
                                <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span>
<span class="st">        </span><span class="kw">is.na</span>(Para<span class="op">$</span>Sci<span class="op">$</span>dp01<span class="op">$</span>co2Turb<span class="op">$</span>RtioMoleDryCo2<span class="op">$</span><span class="st">`</span><span class="dt">Lag$TimeDiff</span><span class="st">`</span>)) <span class="op">|</span>
<span class="st">       </span>(base<span class="op">::</span><span class="kw">length</span>(base<span class="op">::</span><span class="kw">grep</span>(<span class="dt">pattern =</span> <span class="st">&quot;H2O&quot;</span>, 
                                <span class="dt">x =</span> idxVar, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span>
<span class="st">        </span><span class="kw">is.na</span>(Para<span class="op">$</span>Sci<span class="op">$</span>dp01<span class="op">$</span>h2oTurb<span class="op">$</span>RtioMoleDryH2o<span class="op">$</span><span class="st">`</span><span class="dt">Lag$TimeDiff</span><span class="st">`</span>))) {
      
      <span class="co"># Calculate lag</span>
      lag &lt;-<span class="st"> </span><span class="kw">def.lag</span>(<span class="dt">refe =</span> wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>veloZaxs,
                     <span class="dt">meas =</span> wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb[[idxVar]],
                     <span class="dt">lagMax =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>FreqSamp<span class="op">$</span>irgaTurb,
                     <span class="dt">lagCnst =</span> <span class="ot">TRUE</span>,
                     <span class="co"># Only negative lags permitted</span>
                     <span class="dt">lagNgtvPstv =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="st">&quot;np&quot;</span>)[<span class="dv">1</span>],
                     <span class="dt">lagAll =</span> <span class="ot">TRUE</span>,
                     <span class="dt">freq =</span> FreqSamp<span class="op">$</span>irgaTurb,
                     <span class="dt">hpf =</span> <span class="ot">TRUE</span>)
      
      } <span class="cf">else</span> {
        
        <span class="co"># If lag is pre-determined:</span>
        lag &lt;-<span class="st"> </span><span class="kw">list</span>()
        lag<span class="op">$</span>lag &lt;-<span class="st"> </span><span class="kw">ifelse</span>(base<span class="op">::</span><span class="kw">length</span>(base<span class="op">::</span><span class="kw">grep</span>(<span class="dt">pattern =</span> <span class="st">&quot;CO2&quot;</span>, 
                                                  <span class="dt">x =</span> idxVar, 
                                                  <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
                          Para<span class="op">$</span>Sci<span class="op">$</span>dp01<span class="op">$</span>co2Turb<span class="op">$</span>RtioMoleDryCo2<span class="op">$</span><span class="st">`</span><span class="dt">Lag$TimeDiff</span><span class="st">`</span>,
                          Para<span class="op">$</span>Sci<span class="op">$</span>dp01<span class="op">$</span>h2oTurb<span class="op">$</span>RtioMoleDryH2o<span class="op">$</span><span class="st">`</span><span class="dt">Lag$TimeDiff</span><span class="st">`</span>)
        lag<span class="op">$</span>corrCros &lt;-<span class="st"> </span><span class="ot">NaN</span>
        
      }
    
    <span class="co"># Shift data according to lag time</span>
    tmpAttr &lt;-<span class="st"> </span><span class="kw">attributes</span>(wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb[[idxVar]])<span class="op">$</span>unit
    <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.na</span>(lag<span class="op">$</span>lag)) {
      wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb[[idxVar]] &lt;-<span class="st"> </span>
<span class="st">        </span>DataCombine<span class="op">:::</span><span class="kw">shift</span>(<span class="dt">VarVect =</span> wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb[[idxVar]], 
                            <span class="dt">shiftBy =</span> <span class="op">-</span><span class="st"> </span>lag<span class="op">$</span>lag, <span class="dt">reminder =</span> <span class="ot">FALSE</span>)
    }
    <span class="kw">attributes</span>(wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb[[idxVar]])<span class="op">$</span>unit &lt;-<span class="st"> </span>tmpAttr; <span class="kw">rm</span>(tmpAttr)
      
    <span class="co"># Store lag times</span>
    <span class="cf">if</span>(tmpRun <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
      tmpLag &lt;-<span class="st"> </span>lag<span class="op">$</span>lag <span class="op">/</span><span class="st"> </span>FreqSamp<span class="op">$</span>irgaTurb
      tmpCorrCros &lt;-<span class="st"> </span>lag<span class="op">$</span>corrCros
      } <span class="cf">else</span> {
        tmpLag &lt;-<span class="st"> </span><span class="kw">c</span>(tmpLag, lag<span class="op">$</span>lag <span class="op">/</span><span class="st"> </span>FreqSamp<span class="op">$</span>irgaTurb)
        tmpCorrCros &lt;-<span class="st"> </span><span class="kw">c</span>(tmpCorrCros, lag<span class="op">$</span>corrCros)
      }

    <span class="co"># End of lag correction loop</span>
    }

  <span class="co"># Remove temporary variables</span>
  <span class="kw">names</span>(tmpLag) &lt;-<span class="st"> </span>var
  tmpLag &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(tmpLag))
  <span class="kw">names</span>(tmpCorrCros) &lt;-<span class="st"> </span>var
  tmpCorrCros &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(tmpCorrCros))
  <span class="kw">rm</span>(tmpRun, lag, idxVar, var)

  <span class="co"># Derived variables</span>
  <span class="co"># Fast air temperature</span>
  wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>T_air_SONIC &lt;-<span class="st"> </span><span class="kw">unlist</span>(wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>tempSoni <span class="op">/</span><span class="st"> </span>
<span class="st">                                        </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.51</span> <span class="op">*</span><span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>rtioMassH2o))
  base<span class="op">::</span><span class="kw">attr</span>(<span class="dt">x =</span> wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>T_air_SONIC, <span class="dt">which =</span> <span class="st">&quot;unit&quot;</span>) &lt;-<span class="st"> &quot;K&quot;</span>

  <span class="co"># Ambient water vapor saturation pressure</span>
  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="kw">mean</span>(wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>T_air_SONIC, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))) {
    wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presH2oSatAtm &lt;-<span class="st"> </span>
<span class="st">      </span><span class="kw">unlist</span>(<span class="kw">def.pres.h2o.sat.temp.mag</span>(<span class="dt">temp=</span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>T_air_SONIC))
    } <span class="cf">else</span> {
      wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presH2oSatAtm &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">rep</span>(<span class="ot">NaN</span>, <span class="kw">length</span>(wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>T_air_SONIC))
    }
  base<span class="op">::</span><span class="kw">attr</span>(<span class="dt">x =</span> wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presH2oSatAtm, <span class="dt">which =</span> <span class="st">&quot;unit&quot;</span>) &lt;-<span class="st"> &quot;Pa&quot;</span>

  <span class="co"># Ambient relative humidity, including adjustment of partial </span>
  <span class="co"># pressure from cell to ambient via Dalton's law</span>
  wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>rhAtm &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">def.rh.pres.h2o.pres.sat.h2o</span>(<span class="dt">presH2o =</span> wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presH2o, 
                                 <span class="dt">presH2oSat =</span> wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presH2oSatAtm) <span class="op">*</span>
<span class="st">    </span><span class="kw">mean</span>(wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presAtm, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mean</span>(wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presSum, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)

  <span class="co"># Ambient dew point</span>
  wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>tempDew &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">def.temp.dew.pres.h2o.temp.mag</span>(<span class="dt">presH2o =</span> wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presH2o, 
                                   <span class="dt">temp =</span> wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>T_air_SONIC)

  <span class="co"># Assemble data for Level 1 data product generation</span>

  <span class="co"># Create empty temporary lists</span>
  <span class="co"># For data</span>
  wrk<span class="op">$</span>tmp<span class="op">$</span>data &lt;-<span class="st"> </span><span class="kw">list</span>()
  
  <span class="co"># For quality flags and quality metrics</span>
  wrk<span class="op">$</span>tmp<span class="op">$</span>qfqm &lt;-<span class="st"> </span><span class="kw">list</span>()
  
  <span class="co"># Assemble data</span>
  <span class="co"># For sonic anemometer</span>
  wrk<span class="op">$</span>tmp<span class="op">$</span>data<span class="op">$</span>soni &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,
                                  <span class="st">&quot;veloXaxsErth&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>veloXaxs,
                                  <span class="st">&quot;veloYaxsErth&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>veloYaxs, 
                                  <span class="st">&quot;veloZaxsErth&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>veloZaxs,
                                  <span class="st">&quot;veloXaxsYaxsErth&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>veloXaxsYaxsErth,
                                  <span class="st">&quot;angZaxsErth&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>angZaxsErth,                 
                                  <span class="st">&quot;tempSoni&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>tempSoni,
                                  <span class="st">&quot;tempAir&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>soni<span class="op">$</span>T_air_SONIC)
      
  <span class="co"># For AMRS</span>
  wrk<span class="op">$</span>tmp<span class="op">$</span>data<span class="op">$</span>amrs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,
                                  <span class="st">&quot;angNedXaxs&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>amrs<span class="op">$</span>angXaxs,
                                  <span class="st">&quot;angNedYaxs&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>amrs<span class="op">$</span>angYaxs,
                                  <span class="st">&quot;angNedZaxs&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>amrs<span class="op">$</span>angZaxs)
     
  <span class="co"># For CO2</span>
  wrk<span class="op">$</span>tmp<span class="op">$</span>data<span class="op">$</span>co2Turb &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,
                                     <span class="st">&quot;rtioMoleDryCo2&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>rtioMoleDryCo2,
                                     <span class="st">&quot;densMoleCo2&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>densMoleCo2, 
                                     <span class="st">&quot;presAtm&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presAtm,
                                     <span class="st">&quot;presSum&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presSum,
                                     <span class="st">&quot;frt00Samp&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>mfcSampTurb<span class="op">$</span>frt00,
                                     <span class="st">&quot;tempAve&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>tempMean)
    
  <span class="co"># for H2O</span>
  wrk<span class="op">$</span>tmp<span class="op">$</span>data<span class="op">$</span>h2oTurb &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,
                                     <span class="st">&quot;rtioMoleDryH2o&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>rtioMoleDryH2o,
                                     <span class="st">&quot;densMoleH2o&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>densMoleH2o, 
                                     <span class="st">&quot;tempDew&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>tempDew,
                                     <span class="st">&quot;presAtm&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presAtm,
                                     <span class="st">&quot;presSum&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>presSum,
                                     <span class="st">&quot;frt00Samp&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>mfcSampTurb<span class="op">$</span>frt00,
                                     <span class="st">&quot;tempAve&quot;</span> =<span class="st"> </span>wrk<span class="op">$</span>data<span class="op">$</span>irgaTurb<span class="op">$</span>tempMean)

  <span class="co"># Calculate data products </span>
  <span class="co"># Calculate 1 and 2 minute data products</span>
  wrk<span class="op">$</span>dp01AgrSub[[lvlAgr]] &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">wrap.dp01.agr.prd</span>(<span class="dt">inpList =</span> wrk)
  
  <span class="co"># 30-minute data products</span>
  wrk<span class="op">$</span>dp01[[lvlAgr]] &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">wrap.dp01</span>(
    <span class="dt">data =</span> wrk<span class="op">$</span>tmp<span class="op">$</span>data,
    <span class="dt">idx =</span> <span class="kw">c</span>(<span class="st">&quot;soni&quot;</span>, <span class="st">&quot;amrs&quot;</span>, <span class="st">&quot;co2Turb&quot;</span>, <span class="st">&quot;h2oTurb&quot;</span>)
    )
  
          <span class="co"># Standard error removed from 1- and 30- minute, it is now part of the ucrt calculation function</span>
          <span class="kw">lapply</span>(<span class="kw">names</span>(wrk<span class="op">$</span>dp01AgrSub[[lvlAgr]]<span class="op">$</span>data), <span class="cf">function</span>(idxData){
          wrk<span class="op">$</span>dp01AgrSub[[lvlAgr]]<span class="op">$</span>data[[idxData]]<span class="op">$</span>se &lt;&lt;-<span class="st"> </span><span class="ot">NULL</span>
          wrk<span class="op">$</span>dp01[[lvlAgr]][[idxData]]<span class="op">$</span>se &lt;&lt;-<span class="st"> </span><span class="ot">NULL</span>
          })
  
  
  <span class="co"># Another time stamp: Starting quality processing</span>
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;%F %T&quot;</span>), 
               <span class="st">&quot;: Beginning the qfqm data processing for data in loop...&quot;</span>, 
               idxAgr))
  
  <span class="co"># Calculate the quality metrics and determine the final quality flag</span>
  wrk<span class="op">$</span>qfqmOut[[lvlAgr]] &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">wrap.dp01.qfqm.ecte</span>(
    <span class="dt">qfqm =</span> wrk<span class="op">$</span>qfqm,
    <span class="dt">idx =</span> <span class="kw">c</span>(<span class="st">&quot;soni&quot;</span>, <span class="st">&quot;amrs&quot;</span>, <span class="st">&quot;co2Turb&quot;</span>, <span class="st">&quot;h2oTurb&quot;</span>),
    <span class="dt">MethMeas =</span> <span class="st">&quot;ecte&quot;</span>,
    <span class="dt">RptExpd =</span> <span class="ot">TRUE</span> )

  <span class="co"># Remove temporary files</span>
  wrk<span class="op">$</span>data &lt;-<span class="st"> </span><span class="ot">NULL</span>
  wrk<span class="op">$</span>tmp &lt;-<span class="st"> </span><span class="ot">NULL</span>
  <span class="kw">invisible</span>(<span class="kw">gc</span>())

<span class="co"># End loop</span>
}
<span class="co">#&gt; [1] &quot;2018-10-30 12:59:00: Beginning the qfqm data processing for data in loop...1&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 12:59:31: Beginning the qfqm data processing for data in loop...2&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:00:01: Beginning the qfqm data processing for data in loop...3&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:00:32: Beginning the qfqm data processing for data in loop...4&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:01:03: Beginning the qfqm data processing for data in loop...5&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:01:34: Beginning the qfqm data processing for data in loop...6&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:02:05: Beginning the qfqm data processing for data in loop...7&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:02:36: Beginning the qfqm data processing for data in loop...8&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:03:08: Beginning the qfqm data processing for data in loop...9&quot;</span>
<span class="co">#&gt; [1] &quot;2018-10-30 13:03:39: Beginning the qfqm data processing for data in loop...10&quot;</span>
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;%F %T&quot;</span>), 
             <span class="st">&quot;: dataset &quot;</span>, date, 
             <span class="st">&quot; DP01 calculation complete&quot;</span>))
<span class="co">#&gt; [1] &quot;2018-10-30 13:03:50: dataset 2017-09-01 DP01 calculation complete&quot;</span></code></pre></div>
</div>
<div id="aggregate-data-and-quality-metrics" class="section level2">
<h2>7. Aggregate data and quality metrics</h2>
<p>Now, we aggregate the results from section 6. The first step is to aggregate the half-hourly sets of data and qfqm. Then, we plot the final quality flag and its relationship to the alpha and beta quality metrics. (alpha = fraction of data flagged by sensor and statistical plausibility tests; beta = fraction of quality flags not available due to missing data)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Concatenate results using def.dp01.agr.ecte()</span>
out &lt;-<span class="st"> </span>eddy4R.base<span class="op">::</span><span class="kw">def.dp01.agr.ecte</span>(<span class="dt">inpList =</span> wrk, 
                                      <span class="dt">MethSubAgr =</span> <span class="ot">TRUE</span>, 
                                      <span class="dt">MethUcrt =</span> <span class="ot">FALSE</span>)

<span class="co"># Generate qfqm table to be plotted</span>
inpPlot &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">time =</span> 
                        <span class="kw">format</span>(<span class="kw">as.POSIXct</span>(out<span class="op">$</span>time<span class="op">$</span>co2Turb<span class="op">$</span>timeBgn, 
                                          <span class="dt">format=</span><span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>), 
                               <span class="dt">format=</span><span class="st">&quot;%H:%M&quot;</span>),
                      <span class="dt">qfFinl =</span> out<span class="op">$</span>qfqm<span class="op">$</span>soni<span class="op">$</span>qfFinl<span class="op">$</span>veloXaxsYaxsErth,
                      <span class="dt">qmAlph =</span> out<span class="op">$</span>qfqm<span class="op">$</span>soni<span class="op">$</span>qmAlph<span class="op">$</span>veloXaxsYaxsErth,
                      <span class="dt">qmBeta =</span> out<span class="op">$</span>qfqm<span class="op">$</span>soni<span class="op">$</span>qmBeta<span class="op">$</span>veloXaxsYaxsErth)

<span class="co"># Plot final quality flag, alpha metric, and beta metric</span>
<span class="kw">library</span>(ggplot2)

plot =<span class="st"> </span><span class="kw">ggplot</span>(inpPlot, <span class="kw">aes</span>(time)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">y =</span> qfFinl, <span class="dt">fill=</span> <span class="st">&quot;qfFinl&quot;</span>), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> qmAlph, <span class="dt">group =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;qmAlph&quot;</span>), 
            <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> qmBeta, <span class="dt">group =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;qmBeta&quot;</span>), 
            <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;veloXaxsYaxsErth&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="st">&quot; &quot;</span>, 
                      <span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;qfFinl&quot;</span> =<span class="st"> &quot;black&quot;</span>, 
                               <span class="st">&quot;qmAlph&quot;</span> =<span class="st"> &quot;blue&quot;</span>, 
                               <span class="st">&quot;qmBeta&quot;</span> =<span class="st"> &quot;red&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>,<span class="dt">values=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.key =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.box =</span> <span class="st">&quot;vertical&quot;</span>,
        <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">14</span>, 
                                  <span class="dt">face=</span><span class="st">&quot;bold.italic&quot;</span>, 
                                  <span class="dt">hjust =</span> <span class="fl">0.5</span>),
        <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">14</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>),
        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">14</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="op">-</span><span class="fl">0.2</span>,<span class="fl">1.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;qfqm&quot;</span>)

<span class="kw">print</span>(plot)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">          
<span class="co"># Remove temporary files</span>
wrk<span class="op">$</span>dp01 &lt;-<span class="st"> </span><span class="ot">NULL</span>
wrk<span class="op">$</span>dp01AgrSub &lt;-<span class="st"> </span><span class="ot">NULL</span>
wrk<span class="op">$</span>qfqmOut &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
</div>
<div id="format-for-output" class="section level2">
<h2>8. Format for output</h2>
<p>Lastly, we prepare the data for output and write it to the dp01 output HDF5 file. We first create the skeleton structure of the NEON HDF5 file using eddy4R.base::def.hdf5.crte(). We then perform some packaging of the results to match the NEON HDF5 structure and write the output to the NEON dp01 HDF5 file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Drop the quality column (qfqm) after the example;</span>
<span class="co"># these data will be added to the HDF5 structure in </span>
<span class="co"># a future release</span>
<span class="kw">lapply</span>(<span class="kw">names</span>(out<span class="op">$</span>qfqm), <span class="cf">function</span>(x){
  out<span class="op">$</span>qfqm[[x]]<span class="op">$</span>qm &lt;&lt;-<span class="st"> </span><span class="ot">NULL</span>
})  
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; NULL</span>

<span class="co"># Use the def.hdf5.crte() function to generate the </span>
<span class="co"># H5 file in NEON EC format</span>
eddy4R.base<span class="op">::</span><span class="kw">def.hdf5.crte</span>(<span class="dt">Date =</span> date, 
                           <span class="dt">Site =</span> Para<span class="op">$</span>Flow<span class="op">$</span>Loc, 
                           <span class="dt">LvlTowr =</span> Para<span class="op">$</span>Flow<span class="op">$</span>LvlTowr, 
                           <span class="dt">DirOut =</span> base<span class="op">::</span><span class="kw">paste0</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirOut, 
                                                 <span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, 
                                                 <span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>VersDp),
                           <span class="dt">FileOutBase =</span> Para<span class="op">$</span>Flow<span class="op">$</span>FileOutBase, 
                           <span class="dt">MethExpd =</span> <span class="ot">TRUE</span>,
                           <span class="dt">FileNameReadMe =</span> <span class="st">&quot;/home/eddy/inpExmp/ECTE_HDF5_readme.txt&quot;</span>,
                           <span class="dt">FileNameObjDesc =</span> 
                             <span class="st">&quot;/home/eddy/inpExmp/ECTE_HDF5_object_description.csv&quot;</span>)

<span class="co"># Determine the output filename of the file we just created  </span>
FileOut &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">list.files</span>(<span class="dt">path =</span> base<span class="op">::</span><span class="kw">paste0</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirOut, 
                                                <span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>Loc, 
                                                <span class="st">&quot;/&quot;</span>, Para<span class="op">$</span>Flow<span class="op">$</span>VersDp), 
                            <span class="dt">pattern =</span> <span class="st">&quot;.h5&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)

<span class="co"># Call the wrapper function wrap.hdf5.wrte.dp01() to package </span>
<span class="co"># and write data to output HDF5 files, both basic and expanded</span>
eddy4R.base<span class="op">::</span><span class="kw">wrap.hdf5.wrte.dp01</span>(<span class="dt">inpList =</span> out, 
                                 <span class="dt">FileIn =</span> base<span class="op">::</span><span class="kw">paste0</span>(Para<span class="op">$</span>Flow<span class="op">$</span>DirInp,
                                                       <span class="st">&quot;/&quot;</span>,<span class="st">&quot;ECTE_dp0p_&quot;</span>,  
                                                       Para<span class="op">$</span>Flow<span class="op">$</span>Loc, <span class="st">&quot;_&quot;</span>, 
                                                       date, <span class="st">&quot;.h5&quot;</span>), 
                                 <span class="dt">FileOut =</span> FileOut, 
                                 <span class="dt">SiteLoca =</span> Para<span class="op">$</span>Flow<span class="op">$</span>Loc, 
                                 <span class="dt">LvlTowr =</span> Para<span class="op">$</span>Flow<span class="op">$</span>LvlTowr, 
                                 <span class="dt">MethUcrt =</span> <span class="ot">FALSE</span>, 
                                 <span class="dt">MethSubAgr =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
